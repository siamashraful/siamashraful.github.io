<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8">
  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  <script>
    (function () {
      var root = document.documentElement;
      root.classList.remove('no-js');

      function setTheme(theme) {
        if (theme === 'dark' || theme === 'light') {
          root.setAttribute('data-theme', theme);
          return true;
        }
        return false;
      }

      try {
        if (setTheme(localStorage.getItem('theme'))) {
          return;
        }
      } catch (err) {
        /* localStorage may be unavailable; ignore */
      }

      var prefersDark = false;
      if (window.matchMedia) {
        try {
          prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        } catch (err) {
          prefersDark = false;
        }
      }

      setTheme(prefersDark ? 'dark' : 'light');
    })();
  </script>
  {% include head/custom.html %}
</head>
<body>
  {% include header.html %}
  <main class="container" id="content" tabindex="-1">
    {{ content }}
  </main>
  {% include footer.html %}
  <script>
    (function () {
      var storageKey = 'theme';
      var root = document.documentElement;
      var toggle = document.querySelector('#theme-toggle, .theme-toggle, [data-theme-toggle], .toggle-dark, .mode-toggle');
      if (!toggle) return;

      var icon = toggle.querySelector('[data-theme-icon]');
      if (!icon) {
        icon = document.createElement('span');
        icon.setAttribute('data-theme-icon', '');
        icon.setAttribute('aria-hidden', 'true');
        toggle.appendChild(icon);
      }

      function prefersDark() {
        return !!(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
      }

      function safeGet() {
        try {
          var stored = localStorage.getItem(storageKey);
          if (stored === 'dark' || stored === 'light') {
            return stored;
          }
        } catch (err) {
          /* localStorage unavailable */
        }
        return null;
      }

      function safeSet(value) {
        try {
          localStorage.setItem(storageKey, value);
        } catch (err) {
          /* localStorage unavailable */
        }
      }

      function currentTheme() {
        var attr = root.getAttribute('data-theme');
        if (attr === 'dark' || attr === 'light') {
          return attr;
        }
        var stored = safeGet();
        if (stored) {
          return stored;
        }
        return prefersDark() ? 'dark' : 'light';
      }

      function updateToggle(theme) {
        var isDark = theme === 'dark';
        var next = isDark ? 'light' : 'dark';
        icon.textContent = isDark ? 'ðŸŒž' : 'ðŸŒ™';
        toggle.setAttribute('aria-pressed', String(isDark));
        toggle.setAttribute('aria-label', 'Switch to ' + next + ' mode');
        toggle.setAttribute('title', 'Switch to ' + next + ' mode');
      }

      function applyTheme(theme, persist) {
        var mode = theme === 'dark' ? 'dark' : 'light';
        root.setAttribute('data-theme', mode);
        updateToggle(mode);
        if (persist) {
          safeSet(mode);
        }
      }

      applyTheme(currentTheme(), false);

      toggle.addEventListener('click', function () {
        var next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        applyTheme(next, true);
      });
    })();
  </script>
</body>
</html>
